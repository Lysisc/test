/*! test 2014-05-20 17:53:46 */
!function($){function coverAdaptive(){$(".ctd_head_mask").width(document.documentElement.clientWidth);var a=$(".ctd_cover").css("width","100%"),b=new Image;b.src=a.attr("src"),$.browser.msie?b.onreadystatechange=function(){("complete"==b.readyState||"loaded"==b.readyState)&&coverAdaptiveCall(a)}:b.onload=function(){1==b.complete&&coverAdaptiveCall(a)}}function coverAdaptiveCall(a){var b=a.height(),c=parseInt(a.attr("data-CoverLocationY"))/1e4*b;b+c>450&&a.css({width:"100%",height:"auto",top:c})}function coverTurn(a){var b=a?ttdObjUl.find("li:visible").prev():ttdObjUl.find("li:visible").next();1==ttdObj.data("moveAble")&&(ttdObj.data("moveAble",0),$.browser.msie&&"6.0"==$.browser.version?(b.siblings("li").hide(),b.show(0,judgeDisable)):(b.siblings("li").fadeOut(300),b.fadeIn(300,judgeDisable)))}function judgeDisable(){var a=ttdObjUl.find("li:visible"),b=a.index(".ctd_ttd li")+1;ttdObj.find(".ctd_ttd_ctrl a").removeClass("disable"),ttdObj.find(".ctd_ttd_ctrl span").html(b+"/"+ttdObj.find(".ctd_ttd li").length),a.is(".ctd_ttd li:last")&&ttdObj.find(".ctd_ttd_ctrl .next").addClass("disable"),a.is(".ctd_ttd li:first")&&ttdObj.find(".ctd_ttd_ctrl .prev").addClass("disable"),ttdObj.data("moveAble",1)}function scrollEvents(){var a=$(window).scrollTop();clearTimeout(timer),timer=setTimeout(function(){pDotResize($(".progress_bar").data("imgShow"))},500),floatDivPosition(a),ttdObjFixed(a)}1!=INTERFACE.isHost&&INTERFACE.accessState(function(data1,data2){var visitCount=data2.VisitCount,zeroNull=function(a){return 0==a&&(a=""),a},toFixed=function(number,fractionDigits){with(Math)return round(number*pow(10,fractionDigits))/pow(10,fractionDigits)};if(visitCount>1e5&&(visitCount=toFixed(visitCount/1e4,0)+"万+"),$(".link_browse").find("span").text(zeroNull(visitCount)),$(".link_comment").find("span").text(zeroNull(data2.CommentCount)),$(".ctd_comments_title").find("span").text("("+data2.CommentCount+")"),$(".link_share").find("span").text(zeroNull(data2.ShareCount)),$(".link_like").find("span").text(zeroNull(data2.LikeCount)),$(".link_collect").find("span").text(zeroNull(data2.FavouriteCount)),1==data2.CanDownLoadPDF&&$(".link_pdf").attr("href",data2.DownLoadPDFUrl),$.ifPdfVisible(),0==data1.RetCode)return!1;var userName=data1.UserInfo.DisplayName,userUrl=data1.UserInfo.HomePageUrl,userSrc=data1.UserInfo.HeadPhotoUrl,userState='<a class="img" title="'+userName+'" target="_blank" href="'+userUrl+'"><img src="'+userSrc+'"></a>';(1==data1.RetCode||2==data1.RetCode)&&($(".a_popup_login").removeClass("a_popup_login"),$(".ctd_comments_box:first").append(userState),2==data1.RetCode&&$(".ctd_bread").prepend('<a class="ctd_head_a" href="'+data1.TravelMasterUrl+'"><i class="edit"></i>编辑游记</a>'))}),coverAdaptive(),$.browser.msie&&$.browser.version<9&&$(".badge_box").addClass("hack_ie8"),$(".ctd_head_right").on("mouseover",".info_badge a",function(){var a=$(this).attr("class"),b=$(this).offset(),c=$(".badge_box."+a),d=c.outerWidth(),e=c.outerHeight(),f=($(this).parent(".info_badge").offset(),$(this).parents(".ctd_head_right").offset());c.css({top:b.top-f.top-e-16,left:b.left-f.left-d/2+11}).show();var g=document.documentElement.clientWidth,h=c.offset().left,i=h+d,j=b.left-f.left-d/2+11+g-i;i>g?$(".badge_box."+a).css("left",j).find(".badge_box_arr").css("margin-left",i-g-67):$(".badge_box."+a).find(".badge_box_arr").css("margin-left","-67px")}).on("mouseout",".info_badge a",function(){var a=$(this).attr("class");$(".badge_box."+a).hide()}),$(".ctd_head_right").on("mouseover",".badge_box",function(){$(this).show()}).on("mouseout",".badge_box",function(){$(this).hide()});var floatDiv=$(".float_div"),ttdObj=$("#ctd_ttd_tab"),sideObj=$(".ctd_side"),toObj=$(".ctd_main_body"),toTop=toObj.offset().top,titileWidth=1==$(".ttd_title").length?$(".ttd_title").outerWidth():0,offsetLeft=$(".btn_index").outerWidth()+titileWidth,offsetRight=$(".item_div:first").outerWidth()*$(".item_div").length,ttdObjFixed=function(a){if(0==ttdObj.length)return!1;var b=ttdObj.outerHeight(),c=sideObj.outerHeight(),d=$("#ctd_ttd_stop").offset().top;a>sideObj.offset().top+c&&d-80-b>=a?ttdObj[0].style.cssText="position:fixed;top:70px;left:"+sideObj.offset().left+";":a<sideObj.offset().top+c?ttdObj[0].style.cssText="":a>d-80-b&&(ttdObj[0].style.cssText="position:absolute;top:"+(d-sideObj.offset().top-b-70)+"px;right:0;")},floatDivPosition=function(a){var b=toObj.outerHeight()-50,c=(a-toTop)/b*100;floatDiv.width(document.documentElement.clientWidth<=980?980:"100%"),$(".progress_line").find(".line").width(c+"%").siblings(".point").css("left",c-.85+"%"),a>toTop+b&&$(".progress_line").find(".line").css("width","100%"),a>=toTop?floatDiv.show():floatDiv.hide()},pDotResize=function(){$(".ctd_content").each(function(){var a=this,b=$(a).index(".ctd_content"),c=($(a).offset().top-toObj.offset().top)/toObj.outerHeight()*100-.7+"%";if(1!=$(a).data("hadP")&&b>0){$(a).data("hadP",1);var d=$(a).find("h3").text().replace("编辑","");$(".progress_line").append('<p class="p_content_'+b+'" style="left:'+c+';"><i></i><span>'+d+"<em></em></span></p>")}else b>0&&$(".p_content_"+b).css("left",c)})};if(1==ttdObj.length){ttdObj.on("mouseover",".fl",function(){$(this).css("background-color","#fff")}).on("mouseout",".fl",function(){$(this).css("background-color","transparent")}),$.phBackground=function(){var a=$(".ctd_ttd_box"),b=0,c=0;a.each(function(){$(this).find(".fl").length>c&&(c=$(this).find(".fl").length,b=$(this).attr("data-districtId")),$(this).find(".fl").length>0&&$(this).parent("li").css("background","none")}),b>0&&a.each(function(){if($(this).attr("data-districtId")==b){$(this).parent("li").show();var c=a.index(this);$(".ctd_ttd_ctrl span").text(c+1+"/"+a.length),0==c?$(".ctd_ttd_ctrl .prev").addClass("disable"):$(".ctd_ttd_ctrl .prev").removeClass("disable"),c==a.length-1?$(".ctd_ttd_ctrl .next").addClass("disable"):$(".ctd_ttd_ctrl .next").removeClass("disable")}else $(this).parent("li").hide()})};var ttdObjUl=ttdObj.find(".ctd_ttd");ttdObjUl.find("li").length>1&&ttdObj.find(".ctd_ttd_ctrl").show(),ttdObj.data("moveAble",1).find(".ctd_ttd_ctrl a").click(function(){return $(this).hasClass("disable")||($(this).hasClass("prev")&&coverTurn(1),$(this).hasClass("next")&&coverTurn(0)),!1})}$(".progress_bar").css({"margin-left":offsetLeft,"margin-right":offsetRight}).data("imgShow",1);var clickTime=null;if(floatDiv.on("mouseover",".progress_line p",function(){$(this).find("span").show()}).on("mouseout",".progress_line p",function(){$(this).find("span").hide()}).on("click",".progress_line p",function(){if(0!=$(".progress_line").data("isClick")){$(".progress_line").data("isClick",0);var a=parseInt($(this).attr("class").replace("p_content_","")),b=$(".ctd_content").eq(a).offset().top-50;$("html, body").animate({scrollTop:b},500),clearTimeout(clickTime),clickTime=setTimeout(function(){$(".progress_line").data("isClick",1)},600)}}),$.browser.msie&&"6.0"==$.browser.version)$(window).resize(function(){coverAdaptive()});else{var timer=null;$(function(){setTimeout(function(){pDotResize($(".progress_bar").data("imgShow")),floatDivPosition($(window).scrollTop())},500)}),$(window).scroll(function(){scrollEvents()}),$(window).resize(function(){coverAdaptive(),scrollEvents()})}$(".ctd_controls .fl, .text_pic").on("click",function(){var a=$(".ctd_content").find(".img, img"),b=$(this).is(".text_pic");a.is(":visible")?(b?$(".ctd_controls .fl").html("<i></i>图文模式"):$(this).html("<i></i>图文模式"),$(".ctd_controls .fl, .text_pic").addClass("clicked").attr("title","图文模式"),a.hide(),$(".progress_bar").data("imgShow",0)):(b?$(".ctd_controls .fl").html("<i></i>只看文字"):$(this).html("<i></i>只看文字"),$(".ctd_controls .fl, .text_pic").removeClass("clicked").attr("title","只看文字"),a.show(),$(".progress_bar").data("imgShow",1)),$.browser.msie&&"6.0"==$.browser.version||(pDotResize($(".progress_bar").data("imgShow")),floatDivPosition($(window).scrollTop()))});var popObj=$("#del_comment");$(".ctd_comments").on("click",".link_delete",function(){var a=$(this).attr("data-replyId"),b=$(this).offset();return"none"==popObj.css("display")?popObj.show().offset({top:b.top-popObj.outerHeight()-3,left:b.left-popObj.outerWidth()+28}).data("replyId",a):popObj.hide(),!1}),popObj.hover(function(){popObj.data("isHover",1)},function(){popObj.data("isHover",0)}).find(".confirm, .color_white").click(function(){$(this).hasClass("confirm")&&INTERFACE.del_reply({replyId:popObj.data("replyId")}),popObj.hide()}),$(document).click(function(){0==popObj.data("isHover")&&popObj.hide()}),$(".ctd_travels").on("mouseover",".img",function(){$(this).find(".text").show()}).on("mouseout",".img",function(){$(this).find(".text").hide()}),$.pageLinkJump=function(a){INTERFACE.page_link({pageNum:a})},$(".ctd_comments").on("click",".pager_v1 a:not(.gopage)",function(){var a=$(this).attr("data-page");"0"!=a&&INTERFACE.page_link({pageNum:a})})}(jQuery);