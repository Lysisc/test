/*! test 2014-05-20 15:46:54 */
!function(a){function b(b){var c=a(b),d=c.val(),e=d.length;if(c.focus(),document.selection)if(c[0].createTextRange){var f=c[0].createTextRange();f.moveStart("character",e),f.collapse(),f.select()}else c.focus();else"number"==typeof b.selectionStart&&"number"==typeof b.selectionEnd&&(b.selectionStart=b.selectionEnd=e)}a.cookie.raw=!0,a(".link_delete,.btn_delete").click(function(){a.popupbox.show({id:"delJournal"})}),a("#delJournal").on("click",".close, .gsn-btn-6",function(){a.popupbox.close(),a("#pic_content").val("")}),a("#delJournal").on("click",".gsn-btn-2",function(){a(this).gsdisable({callback:function(){INTERFACE.del_journal({TravelId:INTERFACE.TravelId}),a.popupbox.close()}})}),a(".link_comment, .btn_comment").click(function(){a("#picComment").find(".gsn-tiptext").show(),a("#picComment").find(".journal-comment-tip").hide(),a("#pic_content").click();var c=a(this).attr("data-referenceCategory"),d=a("#pic_content"),e=d[0];if(!a(this).hasClass("a_popup_login")){a.popupbox.show({id:"picComment"});var f=a(this).parents(".img_block").attr("id");if(a("#picComment").data("quote",f),a("#picComment").data("type",c),void 0!=f){var g=a("#authorDisplayName").html(),h="引用 @"+g+" 的照片\n";a("#picComment").data("text",h),d.val(h)}}b(e)});var c=a("#picComment .count"),d=c.text();a("#picComment").on("click",".close, .gsn-btn-6",function(){a("#picComment").find(".count").text("1000"),a("#pic_content").val(""),a.popupbox.close()}),a("#picComment").on("click",".gsn-btn-2",function(){var b=a(this).parents("#picComment").find("#pic_content").val(),c=a("#picComment").data("text"),e=b.replace(c,""),f=/\S/g.test(e);if(f){var g=a("#picComment").data("quote"),h=a("#picComment").data("type");a("#picComment").find(".gsn-tiptext").show(),a("#picComment").find(".journal-comment-tip").hide(),a(this).gsdisable({callback:function(){var b=void 0!=g?g:"";INTERFACE.add_comment(a.toJSON({TravelId:INTERFACE.TravelId,ReferenceIds:b,ReferenceCategory:h,RemarkContent:encodeURIComponent(a("#pic_content").val())})),a("#picComment .count").val(d)}})}else a("#picComment").find(".gsn-tiptext").hide(),a("#picComment").find(".journal-comment-tip").show()}),a("#pic_content").gsInputLen(function(b){var e=d-b;if(-1>=e){var f=a("#pic_content"),g=f.val(),h=a.gsSubstring(g,d,1);f.val(h)}else c.html(e);a("#picComment").find(".gsn-tiptext").show(),a("#picComment").find(".journal-comment-tip").hide()});var e=a(".reportmain .count"),f=e.text();a("#report_area").placeholder(),a(".reportmain").on("click","#btnJournalCommment",function(){var b=a(this).attr("data-referenceCategory"),c=a.trim(a("#report_area").val());a(this).hasClass("a_popup_login")||(""==c||c==a("#report_area").attr("placeholder")?(a(".reportmain").find(".gsn-tiptext").hide(),a("#journal-comment-tip").show()):(a(".reportmain").find(".gsn-tiptext").show(),a("#journal-comment-tip").hide(),a("#btnJournalCommment").gsdisable({callback:function(){var c=a("#report_area").attr("data-referenceids");INTERFACE.add_comment(a.toJSON({TravelId:INTERFACE.TravelId,ReferenceIds:c,ReferenceCategory:b,RemarkContent:encodeURIComponent(a("#report_area").val())})),a("#report_area").val(),a(".reportmain .count").val(f)}})))}),a("#report_area").gsInputLen(function(b){var c=f-b;if(-1>=c){var d=a("#report_area"),g=d.val(),h=a.gsSubstring(g,f,1);d.val(h)}else e.html(c);a(".reportmain").find(".gsn-tiptext").show(),a(".reportmain").find(".journal-comment-tip").hide()}),a.con_focus=function(a){b(a)},1!=INTERFACE.isHost&&INTERFACE.accessState(function(b,c){var d=function(a){return 0==a&&(a=""),a};if(a(".link_browse").text(d(c.VisitCount)),a(".graylink").text(d(c.CommentCount)),a(".link_share").find("span").text(d(c.ShareCount)),a(".link_like").find("span").text(d(c.LikeCount)),a(".link_collect").find("span").text(d(c.FavouriteCount)),1==c.CanDownLoadPDF&&a(".link_pdf").attr("href",c.DownLoadPDFUrl),a.ifPdfVisible(),0==b.RetCode)return!1;var e=b.UserInfo.DisplayName,f=b.UserInfo.HomePageUrl,g=b.UserInfo.HeadPhotoUrl,h='<a title="'+e+'" rel="nofollow" href="'+f+'" target="_blank" rel="nofollow"><img width="60" height="60" src="'+g+'"></a><a title="'+e+'" rel="nofollow" href="'+f+'" target="_blank" rel="nofollow">'+e+"</a>";(1==b.RetCode||2==b.RetCode)&&(a(".a_popup_login").removeClass("a_popup_login"),a(".headside").append(h),2==b.RetCode&&(a(".titler_div").children("div").addClass("titler_div_right"),a(".titler_div").prepend('<a id="master_link" class="titler_a" href="'+b.TravelMasterUrl+'"><i class="edit"></i>编辑游记</a>')))})}(jQuery);