/*! test 2014-05-20 17:53:46 */
function filterBaiduEdit(a){return a=a.replace(/<script[^>]*?>[\s\S]*?<\/script>|<link.*?>|<style[^>]*?>[\s\S]*?<\/style>|<iframe.*?>[\s\S]*?<\/iframe>/gi,""),a=a.replace(/<pre.*?>|<\/pre>/gim,""),a=a.replace(/<\/(?!p|strong)[^>]*?>|<(?!img|p|strong|hr|br|\/)[^>]*?>/gi,""),a=a.replace(/<((?:img)|(?:p)|(?:strong)|(?:hr)|(?:br))[^>]*?>/gi,function(a){if(void 0==a)return"";var b=a;b=b.replace(/\s{1,}/g," "),b=b.replace(/[<'">]/g,"");var c=b.split(" "),d="",e=c[0].toLowerCase();switch(e){case"img":var f="";for(var g=1 in c){var h=c[g];if(-1!=h.indexOf("=")){var i=h.split("=");if("src"==i[0]){var j=[];for(g=1;g<i.length;g++)j.push(i[g]);f+=' src="'+j.join("=")+'"'}"phsid"==i[0]&&(f+=' phsid="'+i[1]+'"'),"cover"==i[0]&&(f+=' cover="selected" class="cover"'),"data-id"==i[0]&&(f+=' data-id="'+i[1]+'"'),d=e+f+" /"}}break;default:d=e}return d?d="<"+d+">":void 0})}var doTime={debug:!1,time:null,s:"",e:"",begin:function(){var a=new Date;this.s=x=a.getTime(),this.log("开始 : "+a.toLocaleTimeString())},end:function(){var a=new Date;this.e=x=a.getTime(),this.log("结束 : "+a.toLocaleTimeString())},cal:function(){var a=this.e-this.s;this.log("运行时间:"+a+"毫秒")},log:function(a){this.debug&&console.log(a)}};!function(a){function b(a){var b=document.createElement("div"),c=document.createTextNode(a);return b.appendChild(c),b.innerHTML}a.editTagArr=function(){var b=[];return a(".edit_tag .current").each(function(){b.push(a(this).find("a").text())}),b=b.join(",")},a.fn.extend({inlineEdit:function(c){return c=a.extend({type:"textarea",maxlen:10,btnYes:{text:"确认",classname:"gsn-btn-2"},btnNo:{text:"取消",classname:"gsn-btn-6"},callback:"",beginFN:"",endFN:""},c),this.each(function(){var d=this,e=(a(this).attr("id"),a.trim(a(d).find("div[data-text]").html())),f=!1,g=function(){if(!f){var b=[];null==e&&b.push('<div data-text="1"></div>'),b.push('<div class="textareaframe" style="display:none">'),b.push("textarea"==c.type?'<textarea class="textarea"></textarea>':'<input type="text" class="textarea" />'),b.push('<a href="javascript:;" data-id="yes" class="'+c.btnYes.classname+'">'+c.btnYes.text+"</a>"),b.push('<a href="javascript:;" data-id="no" class="'+c.btnNo.classname+'">'+c.btnNo.text+"</a>"),c.maxlen>0&&b.push('<div class="msg">还可以输入<span>'+c.maxlen+"</span>字</div>"),b.push("</div>"),a(d).prepend(a(b.join(""))),f=!0}};g();var h=a(this).find("a[data-edit]"),i=a(this).find(".textareaframe"),j=(i.find(".msg"),i.find(".textarea")),k=a(this).find("div[data-text]");if(c.maxlen>0){var l=i.find(".msg").find("span"),m=l.text();j.gsInputLen(function(b){var c=m-b;if(-1>=c){var d=j.val(),e=a.gsSubstring(d,m,1);j.val(e),l.html(0)}else l.html(c)})}h.on("click",function(){return e=a.trim(a(d).find("div[data-text]").html()),j.val(e),doTime.begin(),a(this).hide(),k.hide(),i.show(),"function"==typeof c.beginFN&&c.beginFN(d),doTime.end(),doTime.cal(),j.triggerHandler("focus"),!1});var n=function(a){h.show(),i.hide(),k.show(),"function"==typeof c.endFN&&c.endFN(d,j.val(),e,a)};btnYN=i.find("a"),btnYN.on("click",function(){var b=a(this).attr("data-id");switch(b){case"yes":o();break;case"no":j.val(k.text())}return"function"==typeof c.callback&&c.callback(b),n(b),!1});var o=function(){var a=j.val();a=b(a),k.html(a)}})}})}(jQuery),$(function(){function a(a){return re=/(.*\/)/gi,r=a.match(re),r[0]+"images/swfupload_fp9.swf"}{var b=$("#gs_static_resource").val(),c=$("#gs_uploadurl").val();$("#gs_imgRootPath").val()}window.UEDITOR_CONFIG={UEDITOR_HOME_URL:1==$("#gs_edit_istest").val()?"/js/app/member/ueditor_utf8/":"/j/member/ueditor/",initialContent:$("#addText").val(),initialFrameWidth:"auto",elementPathEnabled:!1,contextMenu:[],zIndex:100,wordCount:0,sourceEditor:"textarea",toolbars:[["bold","horizontal"]],labelMap:{anchor:"",undo:""},lang:"zh-cn-utf8"};var d=UE.getEditor("editor-wrap");d.addListener("ready",function(){var a=$("#addText").val();window.setTimeout(function(){d.setContent(a),iframe_edit_event()},500),JournalAction.init("editor-wrap")}),$.browser.msie&&"10.0"==$.browser.version&&d.ready(function(){window.setTimeout(function(){iframe_edit_event()},500),JournalAction.init("editor-wrap")}),d.addListener("beforePaste",function(a,b){b.html=filterBaiduEdit(b.html),iframe_edit_event()});var e=null,f=function(){e=$("<div>").attr("class","photo-mask").html('<div class="mask-bg"></div>'),titlePagecon=$("<em>").attr("class","mask-name").html("设为封面"),e.append(titlePagecon).appendTo("body")};f(),iframe_edit_event=function(){window.iframe_init=1;var a=$(document.getElementById("baidu_editor_0").contentWindow.document.body),b=$("#baidu_editor_0");a.find("img").live("mouseover",function(){e.css({width:$(this).css("width")}),void 0==$(this).attr("data-id")&&$(this).attr("data-id",(new Date).getTime().toString());var a=$(this).offset().left+b.offset().left,c=$(this).offset().top+b.offset().top,d=$(this).width(),f=($(this).height(),{top:c+12,left:a+2});d>180&&(e.find("em").attr("data-id",$(this).attr("data-id")),e.css(f).show().hover(function(){$(this).show()})),$(this).hasClass("cover")?e.find("em").addClass("ok").html("已设为封面"):e.find("em").removeClass("ok").html("设为封面")}).live("mouseout",function(){e.hide()}),a.live("mouseout",function(){e.hide()}),e.click(function(){var b=$(this).find("em").attr("data-id");return $(this).find("em").addClass("ok").html("已设为封面"),a.find("img").each(function(){b==$(this).attr("data-id")?$(this).attr("cover","selected").addClass("cover"):$(this).removeAttr("cover").removeClass("cover")}),!1})},$(".sideCon").setfixed(),$("#tags-avilable").find("em").click(function(){var a=$("#tag").val()+",",b=$(this).text();if(-1==a.indexOf(b)){var c=$(this).text().trim(),d=$("#tag").val();""!=d&&(d+=","),$("#tag").val(d+c)}return!1});var g={};if(gs_ua.pv[0]){var h,g,i=function(){var a=$("#photolist").find("li").length;"1"==a&&$(".uplpad_info_pic_1").show()},j=(new Date).getTime(),k={debug:!1,flash_url:a(c),upload_url:c,post_params:{type:"journals",typeID:13,token:"78A566F2-AA8A-4C4C-8EE8-F99FB3D4A1D8",randomKey:j},file_size_limit:"10 MB",file_types:"*.jpg;*.jpeg;*.png",file_types_description:"JPG Images",file_upload_limit:0,file_queue_limit:50,button_image_url:b+"/img/member/editor/bg-swfuploadimg.png?"+j,button_width:74,button_height:24,button_placeholder_id:"spanButtonPlaceholder",button_text:'<span class="theFont">&nbsp;</span>',button_text_style:".theFont { font-size: 16; }",button_cursor:SWFUpload.CURSOR.HAND,button_text_left_padding:0,button_text_top_padding:0,file_queued_handler:function(a){this.uploadNumber=this.getStats().files_queued,this.isOverMaxcount=!1,g=this;var b=$('<li class="item" id="'+a.id+'"><span></span><i class="close"></i><a style="display:none" class="btn_cancel" href="javascript:;">取消上传</a></li>');b.hover(function(){$(this).find(".close").show().click(function(){return $(this).parent().remove(),i(),!1})},function(){$(this).find(".close").hide()}),b.bind("click",function(){var a=(d.getContent(),$(this).find("img")),b=a.attr("imgid"),c=$(a).attr("width");if(!isNaN(b)){c>560&&(c=560);var e=a.attr("data-pic"),f='<p><img width="'+c+'" data-id="'+b+'" phsid="'+b+'" src="'+e+'" alt=""></p>';d.execCommand("insertHtml",f),$(this).remove(),iframe_edit_event()}return i(),!1}),b.find("a.btn_cancel").bind("click",function(){try{return this.stopUpload(),this.cancelUpload(),$(this).parent().remove(),!1}catch(a){}}),"none"!==$(".uplpad_info_pic_1").css("display")&&$(".uplpad_info_pic_1").hide(),$("#photolist ul").append(b)},file_queue_error_handler:function(a,b){try{switch(b){case SWFUpload.QUEUE_ERROR.QUEUE_LIMIT_EXCEEDED:try{$("#tipOverMaxcount,.bgbox").show(),g.isOverMaxcount=!0,g.stopUpload()}catch(c){}break;case SWFUpload.QUEUE_ERROR.FILE_EXCEEDS_SIZE_LIMIT:$(".uplpad_info_pic_1").hide();var d='<span class="filename">'+a.name.lastsubCHStr(10)+'</span><span class="errorMsg">文件超过10M</span>';$('<li class="ui-widget-content failed">').append('<span id="'+a.id+'"><strong class="failed"></strong></span>'+d+'<i class="close"></i>').appendTo($("#photolist ul")).hover(function(){$(this).find("i").show()},function(){$(this).find("i").hide()}).find("i").click(function(){return $(this).parent().remove(),i(),!1});break;case SWFUpload.QUEUE_ERROR.INVALID_FILETYPE:alert("您选择的文件含有其他格式文件");break;default:$(".uplpad_info_pic_1").hide();var d='<span class="filename">'+a.name.lastsubCHStr(10)+'</span><span class="errorMsg">上传失败</span>';$('<li class="ui-widget-content failed">').append('<span id="'+a.id+'"><strong class="failed"></strong></span>'+d+'<i class="close"></i>').appendTo($("#photolist ul")).hover(function(){$(this).find("i").show()},function(){$(this).find("i").hide()}).find("i").click(function(){return $(this).parent().remove(),!1})}}catch(c){this.debug(c)}},file_dialog_complete_handler:function(a,b){try{b>0&&(this.startUpload(),doTime.begin())}catch(c){}},upload_start_handler:function(){},upload_progress_handler:function(a,b,c){var d=Math.ceil(b/c*100);$("#"+a.id+" span").html(d+"%")},upload_error_handler:function(a,b){SWFUpload.UPLOAD_ERROR.FILE_CANCELLED==b&&g.isOverMaxcount&&$("#"+a.id).remove()},upload_success_handler:function(a,b){doTime.end(),doTime.cal(),doTime.begin();var c=new Function("return "+b.replace(/(<script)+[^<>]*>[^\0]*(<\/script>)+/gm,""))();if("undefined"!=typeof c.error&&""==c.error){var d=c.data[0],e='<img data-pic="'+d.metalUrl+'" imgid="'+d.data+'" src="'+d.thumbUrl+'" width="'+d.width+'" alt="">';$("#"+a.id+" span").html($(e)),doTime.end()}else alert("无效的数据");doTime.cal()},upload_complete_handler:function(a){$("#"+a.id).find("a").hide()},queue_complete_handler:function(){}};h=new SWFUpload(k)}else $(".btn-upload").html('请安装或启用<a href="http://www.adobe.com/go/getflashplayer/" target="_blank">Flash组件</a>');var l=null;$('.addtagbox[data-id="addTagBox"]').inlineEdit({maxlen:0,type:"input",btnYes:{text:"保存",classname:"gsn-btn-2"},btnNo:{text:"取消",classname:"editcancel"},beginFN:function(a){$(a).find(".textundis").text(""),$(a).find(".textarea").val("").focus();var b=$(a).find(".textarea");b.bind("keyup change mousedown blur focus",function(){function c(){$(a).siblings(".tag-tip").hide()}var d=b.val().replace(/\,*/g,""),e=d.replace(/\s/gi,"x").replace(/[^x00-xff]/g,"xx"),f=Math.ceil(e.length/2);if(f>10){clearTimeout(l),$(a).siblings(".tag-tip").text("标签请控制在10个字以内").show();var g=$.gsSubstring(d,10,1);b.val(g),l=setTimeout(c,3e3)}else b.val(d)})},endFN:function(a){clearTimeout(l);var b=$(a),c=!0,d=null;$(a).siblings(".tag-tip").hide(),b.find(".textundis").css("display","none");var e=$(a).find(" .textundis").text();e=$.trim(e);var f=$(a).siblings("ul");if(f.find("li").each(function(){var a=$(this).find("a").text();e==a&&($(this).hasClass("current")?c=!1:($(this).addClass("current"),d=$(this)))}),""!==e&&c){var g=null;d?g=d:(g=$('<li class="current"><a href="javascript:;" data-tagqouteid="0" data-tagid="0">'+e+"</a></li>"),$(".edit_tag ul").append(g))}}}),$(document).on("click",".edit_tag li",function(){return $(this).hasClass("current")?$(this).removeClass("current"):$(this).addClass("current"),!1})});