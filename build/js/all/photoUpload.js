/*! test 2014-05-20 17:53:46 */
function delImg(a){var b=($(".photo_progress ul li").length,$(".state_proccessing").find("span:first").text());$(".state_proccessing").find("span:first").text(b-1),INTERFACE.del_img($.toJSON({TravelId:INTERFACE.TravelId,ImageId:a})),setTimeout(function(){$(".photo_progress ul li[data-imgId="+a+"]").animate({opacity:.15,height:0},600,function(){$(this).remove(),toggleDet(swfu)})},300)}function toggleDet(a,b){var c=$(".photo_progress ul li").length;a.setButtonTextStyle(".redText { color: #666666; font-weight: bold; font-size: 14px; }"),0===c?(a.setButtonText("<span class='redText'>上传照片</span>"),$(".upload_btn").addClass("abs_btn"),$(".btn_center").hide().find(".state_proccessing").html(""),$(".upload_det").show(),b?$(".limit").css("color","red").html(b):$(".limit").css("color","#999").html("一次性传完照片，你的丰富行程将立即展现！")):(a.setButtonText("<span class='redText'>继续上传</span>"),$(".upload_btn").removeClass("abs_btn"),$(".btn_center").show(),$(".upload_det").hide(),b?$(".state_proccessing").css("color","red").html(b):$(".state_proccessing").css("color","#666"))}function format_data(a){var b=new Function("return "+a.replace(/(<script)+[^<>]*>[^\0]*(<\/script>)+/gm,""))();if("undefined"!=typeof b.error&&""==b.error)var c=b.data[0];return c}var swfu={};$(function(){function a(a){return"<li id="+a.id+" data-imgId=\"\"><div><a class='btnCancel' href='javascript:void(0);'>×</a><span></span><p title=\""+a.name+'">'+a.name+"</p></div><i></i></li>"}function b(a){return"<li id="+a.id+' class="errorMsg"><div><span>大于10M，请重新选择</span><p title="'+a.name+'">'+a.name+"</p></div></li>"}function c(a){return re=/(.*\/)/gi,r=a.match(re),r[0]+"images/swfupload_fp9.swf"}function d(a,b){$("#"+a).find(".btnCancel").click(function(){b.cancelUpload(a,!1);var c=$("#"+a).attr("data-imgId");""!=c&&INTERFACE.del_img($.toJSON({TravelId:INTERFACE.TravelId,ImageId:c})),setTimeout(function(){$("#"+a).animate({opacity:.15,height:0},600,function(){var a=b.getStats();""!=c&&(--a.successful_uploads,b.setStats(a),e(a)),$(this).remove(),b.getStats().files_queued?$("#step2_button").disableButton(!1):toggleDet(b)})},300)})}function e(a){var b=0==a.successful_uploads?"。":"照片已保存。",c=a.upload_errors>0?'上传失败 <span class="red">'+a.upload_errors+"</span> 张"+("。"==b?"":"，"):"",d=c+b=="。"?"":"，";$(".state_proccessing").html('已成功上传 <span class="green">'+a.successful_uploads+"</span> 张"+d+c+b),$("#step2_button").disableButton(0==a.successful_uploads?!1:!0)}if(!gs_ua.pv[0])return $(".upload_btn").html('请安装或启用<a href="http://www.adobe.com/go/getflashplayer/" target="_blank">Flash组件</a>'),!1;{var f=$("#gs_uploadurl").val();$("#imgRootPath").val()}swfu=new SWFUpload({upload_url:f,flash_url:c(f),file_types:"*.jpg;*.jpeg;*.png;*.bmp;*.gif",file_size_limit:"10MB",file_queue_limit:0,debug:!1,prevent_swf_caching:!1,preserve_relative_urls:!1,button_placeholder_id:"flashLink",button_image_url:INTERFACE.button_image,button_width:128,button_height:36,button_text:"<span class='redText'>上传照片</span>",button_text_style:".redText { color: #666666; font-weight: bold; font-size: 14px; }",button_text_left_padding:45,button_text_top_padding:8,button_action:SWFUpload.BUTTON_ACTION.SELECT_FILES,button_cursor:SWFUpload.CURSOR.HAND,button_disabled:!1,post_params:{"new":1,source:1,type:"journals",token:"78A566F2-AA8A-4C4C-8EE8-F99FB3D4A1D8",randomKey:(new Date).getTime(),typeid:INTERFACE.typeid,title:INTERFACE.title,userid:INTERFACE.userid,journalid:INTERFACE.TravelId},file_queue_error_handler:function(a,c){try{var d="";switch(c){case SWFUpload.QUEUE_ERROR.FILE_EXCEEDS_SIZE_LIMIT:$("#file_list").append(b(a)),$("#"+a.id).find("p").width(355),toggleDet(swfu);var f=swfu.getStats();++f.upload_errors,swfu.setStats(f),e(f);break;case SWFUpload.QUEUE_ERROR.INVALID_FILETYPE:d="您选择的文件含有其他格式文件",toggleDet(d)}}catch(g){this.debug(g)}},file_queued_handler:function(b){try{$("#step2_button").disableButton(!1),$("#file_list").append(a(b)),toggleDet(swfu),d(b.id,this)}catch(c){this.debug(c)}},file_dialog_complete_handler:function(a,b){try{if(b>0){this.startUpload();var c=this.getStats(),d=c.files_queued+c.successful_uploads+c.upload_errors+c.upload_cancelled;$(".state_proccessing").html('已上传 <span class="green">'+c.successful_uploads+"</span> / "+d+"张...").css("color","#666")}}catch(e){this.debug(e)}},upload_progress_handler:function(a,b,c){try{var d=Math.ceil(b/c*100),e=$("#"+a.id);e.find("i").width(d+"%"),e.find("span").html(100==d?"100% 处理中":d+"%")}catch(f){this.debug(f)}},upload_complete_handler:function(){try{var a=this.getStats(),b=a.files_queued+a.successful_uploads+a.upload_errors+a.upload_cancelled;a.files_queued?$(".state_proccessing").html('已上传 <span class="green">'+a.successful_uploads+"</span> / "+b+" 张..."):e(a)}catch(c){this.debug(c)}},upload_success_handler:function(a,b){try{var c=format_data(b),d=this.getStats();if("0"==c.data)return--d.successful_uploads,this.setStats(d),e(d),void(window.console&&console.log("图片服务端无数据返回！请确认服务器端口是否正确！"));0==this.getStats().successful_uploads||this.getStats().files_queued||$("#step2_button").disableButton(!0);var f=""==c.server_data?0:c.data;if($("#"+a.id).find("span").html("完成"),$("#"+a.id).attr("data-imgId",f),c.width>=600)INTERFACE.upload_success({TravelId:INTERFACE.TravelId,ImageId:c.data,ImageName:encodeURIComponent(c.fileName),ImageDate:c.shootTime,TravelDate:INTERFACE.TravelDate});else{$("#"+a.id).addClass("errorMsg").find("p").width(310).end().find("a,i").remove().end().find("span").html("宽度小于600像素，请重新选择");{var g=this.getStats();$("#file_list").find("li").not(".errorMsg").length}--g.successful_uploads,++g.upload_errors,this.setStats(g)}}catch(h){this.debug(h)}}})}),$.fn.disableButton=function(a){{var b=$(this);b.attr("disabled")}a?(b.removeAttr("disabled"),b.removeClass("disable")):(b.attr("disabled","true"),b.addClass("disable"))};