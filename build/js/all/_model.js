/*! test 2014-05-20 15:46:54 */
function toFixed(number,fractionDigits){with(Math)return round(number*pow(10,fractionDigits))/pow(10,fractionDigits)}function addCommentTotal(a){var b=INTERFACE.isHost,a=a||0;if(b){var c=$(".ctd_data .ctd_georgia.color_05"),d=c.text();d=a,d>1e5&&(d=toFixed(d/1e5,0)+"<em>万+</em>"),c.text(d),c.attr("title",a)}else{var e=$(".ctd_controls .link_comment"),c=e.find("span");c.text(a)}$(".ctd_comments .ctd_comments_title span").html("("+a+")")}function addCommentNum(){var a=INTERFACE.isHost,b=0;if(a){var c=$(".ctd_data .ctd_georgia.color_05"),d=c.text();b=parseInt(c.attr("title"),10),b=isNaN(b)?0:b,b++,d=b,d>1e5&&(d=toFixed(d/1e5,0)+"<em>万+</em>"),c.text(d),c.attr("title",b)}else{var e=$(".ctd_controls .link_comment"),c=e.find("span");b=parseInt(c.text(),10),b=isNaN(b)?0:b,b++,c.text(b)}$(".ctd_comments .ctd_comments_title span").html("("+b+")")}function con_focus(a){var b=$(a),c=b.val(),d=c.length;if(b.focus(),document.selection)if(b[0].createTextRange){var e=b[0].createTextRange();e.moveStart("character",d),e.collapse(),e.select()}else b.focus();else"number"==typeof a.selectionStart&&"number"==typeof a.selectionEnd&&(a.selectionStart=a.selectionEnd=d)}var doReply=function(){$(".ctd_comments_box").hover(function(){$(this).find(".ctd_comments_contrl .contrl_01").css("color","#999")},function(){$(this).find(".ctd_comments_contrl .contrl_01").css("color","#f2f2f2")}),$("[data-onsubmit]").each(function(){$(this).data("isOne",0)});var a=1e3;$(".ctd_comments .link_reply").click(function(){if(!$(this).hasClass("a_popup_login")){var a=$(this).parent().siblings(".ctd_comments_reply");if(a.is(":visible"))a.slideUp(200);else{a.slideDown(200),a.find("textarea").val("");var b=$(this).parents(".ctd_comments_box").find(".ctd_comments_username").text();b="@"+$.trim(b)+"\n",a.find("textarea").val(b),a.find("textarea").data("name",b),con_focus(a.find("textarea")[0])}}}),$(".ctd_comments .ctd_comments_reply .contrl_01").click(function(){return $(this).parent().slideUp(200),!1}),$(".ctd_comments_reply textarea").each(function(){var b=$(this);b.gsInputLen(function(c){var d=b.parents(".ctd_comments_reply"),e=d.find(".word_length"),f=a-c;if(-1>=f){var g=b.val(),h=$.gsSubstring(g,a,1);b.val(h)}else e.html(f);d.find(".error_tip").hide()})}),$(".ctd_comments_reply .gs_btn_v2").click(function(){var a=$(this).siblings(".textarea").find("textarea"),b=$(this).siblings(".error_tip");areaVal=$.trim(a.val());var c=$.trim(a.data("name")),d=areaVal.replace(c,""),e=a.attr("data-referenceCategory")||"",f=a.attr("data-referenceids")||"";d?$(this).gsdisable({callback:function(){INTERFACE.add_comment({TravelId:INTERFACE.TravelId,ReferenceIds:f,ReferenceCategory:e,RemarkContent:encodeURIComponent(areaVal)},function(){addCommentNum()})}}):b.show()})};$(function(){function a(){"0"==privateObject.CurrentUserId&&$.cookiedb({name:"gs_link_like",value:INTERFACE.TravelId})}function b(){if("0"==privateObject.CurrentUserId){var a=$.cookiedb({name:"gs_link_like",value:INTERFACE.TravelId,isfind:1});"repeat"==a&&($(".float_div .btn_like").addClass("click_like"),$(".ctd_controls .link_like").addClass("click_like"))}}function c(a){var b=$(a),c=$(".ctd_data .color_03"),d=c.text(),e=parseInt(c.attr("title"),10);e=isNaN(e)?0:e,e++,d=e,d>1e5&&(d=toFixed(d/1e5,0)),c.text(d),c.attr("title",e),b.html("<i></i>已自恋"),b.attr("title","已自恋")}var d=INTERFACE.isHost;$(".ctd_controls .link_collect").gsbasecollect({requestFn:function(a){$(".float_div .btn_collect").addClass("click_collect"),INTERFACE.collectRequestFn($(a))}}),$(".float_div .btn_collect").gsbasecollect({requestFn:function(a){var b=$(".ctd_controls .link_collect"),c=b.find("span"),d=parseInt(c.text(),10),d=isNaN(d)?0:d;d++,c.text(d),b.addClass("click_collect"),INTERFACE.collectRequestFn($(a))}}),b(),$(".ctd_controls .link_like").gsbaselike({requestFn:INTERFACE.likeRequestFn,callback:function(b){d?(c(b),$(".float_div .btn_like").addClass("click_like_host")):($(".float_div .btn_like").addClass("click_like"),a())}}),$(".float_div .btn_like").gsbaselike({requestFn:INTERFACE.likeRequestFn,callback:function(){var b=$(".ctd_controls .link_like");if(d)c(b),$(".float_div .btn_like").addClass("click_like_host");else{var e=b.find("span"),f=parseInt(e.text(),10);f=isNaN(f)?0:f,f++,b.html("<i></i>已喜欢<span>"+f+"</span>"),$(".float_div .btn_like").addClass("click_like"),a()}b.addClass("click_like")}}),$(".img_controls .link_like").gsbaselike({requestFn:INTERFACE.likeRequestFn,callback:function(a){var b=$(a);if(d){var c=b.find("span"),e=(c.text(),parseInt(c.attr("title"),10));e=isNaN(e)?0:e,e++,b.html("<i></i>已自恋<span>"+e+"</span>"),b.attr("title","已自恋")}}}),$(".ctd_controls .link_share").gsbaseshare({api:INTERFACE.ShareUrl,hasCount:!0,callback:function(){if(d){var a=$(".ctd_data .color_04"),b=a.text(),c=parseInt(a.attr("title"),10);c=isNaN(c)?0:c,c++,b=c,b>1e5&&(b=toFixed(b/1e5,0)),a.text(b),a.attr("title",c)}}}),$(".float_div .btn_share").gsbaseshare({api:INTERFACE.ShareUrl,fixed:!0,top:50,hasCount:!1,callback:function(){if(d){var a=$(".ctd_data .color_04"),b=a.text(),c=parseInt(a.attr("title"),10);c=isNaN(c)?0:c,c++,b=c,b>1e5&&(b=toFixed(b/1e5,0)),a.text(b),a.attr("title",c)}else{var e=$(".ctd_controls .link_share span"),c=parseInt(e.text(),10);c=isNaN(c)?0:c,c++,e.text(c)}}}),$(".img_controls .link_share").gsbaseshare({api:INTERFACE.ShareUrl});var e=null;$(".ctd_main").on("mouseenter",".img",function(){var a=$(this).data("isOver",1),b=a.find(".img_controls"),c=(a.outerWidth()-a.find("img").outerWidth())/2;c>267?b.css("visibility","hidden"):b.css("visibility","visible").fadeIn("fast"),b.fadeIn("fast"),$("#bdshare").hover(function(){a.data("isOver",0)},function(){a.data("isOver",1)})}),$(".ctd_main").on("mouseleave",".img",function(){function a(){1==b.data("isOver")&&b.children(".img_controls").fadeOut("fast")}clearTimeout(e);var b=$(this);e=setTimeout(a,50)})}),$(function(){!function(){var a=$("#report_area"),b=a.parents(".textarea_box").find(".error_tip");total=1e3,a.val(""),a.placeholder(),a.focus(function(){b.hide()});var c=a.next(".ctd_comments_tip").find("em.word_length");a.gsInputLen(function(b){var d=total-b;if(-1>=d){var e=a.val(),f=$.gsSubstring(e,total,1);a.val(f),c.text(total)}else c.text(b);$(".reportmain").find(".gsn-tiptext").show(),$(".reportmain").find(".journal-comment-tip").hide()}),$(".float_div .btn_comment").add(".ctd_controls .link_comment").click(function(){var b=$(".ctd_comments").offset().top-55;$("body,html").animate({scrollTop:b},500,function(){con_focus(a[0])})}),$(".ctd_comments_box .btn_publish").click(function(){if(!$(this).hasClass("a_popup_login")){var d=a.val();if(d=$.trim(d),d=d.replace("Hi，楼主等你的回复呢~","")){var e=a.attr("data-referencecategory")||"",f=a.attr("data-referenceids")||"";$(this).gsdisable({disable:"gs_btn_v2_gray",text:'<img class="btn_ajax" src="http://youresource.c-ctrip.com/img/load.gif" />提交中...',callback:function(){INTERFACE.add_comment({TravelId:INTERFACE.TravelId,ReferenceIds:f,ReferenceCategory:e,RemarkContent:encodeURIComponent(d)},function(){addCommentNum(),a.val(""),c.text("0")})}})}else b.show()}})}(),function(){var a=$("#picComment"),b=$("#pic_content"),c="",d="",e=a.find(".count"),f=parseInt(e.text(),10);$(".img_controls .link_comment").click(function(){if(a.find(".gsn-tiptext").show(),a.find(".journal-comment-tip").hide(),b.click(),!$(this).hasClass("a_popup_login")){$.popupbox.show({id:"picComment"}),c=$(this).attr("data-referenceCategory")||"",d=$(this).attr("data-referenceids")||"";var e=$("#authorDisplayName").html();e=$.trim(e);var f="引用 @"+e+" 的照片\n";b.val(f)}con_focus(b[0])}),b.gsInputLen(function(c){var d=f-c;if(-1>=d){var g=b.val(),h=$.gsSubstring(g,f,1);b.val(h)}else e.html(d);a.find(".gsn-tiptext").show(),a.find(".journal-comment-tip").hide()}),a.on("click",".close, .gsn-btn-6",function(){e.text(f),b.val(""),$.popupbox.close()}),a.on("click",".gsn-btn-2",function(){var g=b.val();g=$.trim(g),g?(a.find(".gsn-tiptext").show(),a.find(".journal-comment-tip").hide(),$(this).gsdisable({callback:function(){INTERFACE.add_comment({TravelId:INTERFACE.TravelId,ReferenceIds:d,ReferenceCategory:c,RemarkContent:encodeURIComponent(g)},function(){addCommentNum(),e.text(f),b.val(""),$.popupbox.close()})}})):(a.find(".gsn-tiptext").hide(),a.find(".journal-comment-tip").show())})}()});